function parseISO8601(n) { var t = new Date(NaN), r, i = /^\s*(\d{4})-(\d\d)-(\d\d)\s*$/.exec(n); return i && (r = +i[2], t.setFullYear(i[1], r - 1, i[3]), r != t.getMonth() + 1 && t.setTime(NaN)), t } (function (n) { n.fn.extend({ dateranges: function (t) { function o(n, t) { u.data("es_date", n); f.data("es_date", t); h.val(n.format(i.format) + " " + i.andstr + " " + t.format(i.format)).data("date", n.format(i.format) + " " + i.andstr + " " + t.format(i.format)); u.calendar("moveTo", n); f.calendar("moveTo", t) } function p() { var n = r.offset(); e.fadeIn(500).offset({ left: n.left, top: n.top + r.height() + 6 }) } function c(t) { if (r.unbind("mouseout").unbind("mouseover"), e.unbind("mouseout").unbind("mouseover"), n(document).unbind("click"), e.fadeOut(t ? 100 : 400), t && i.onClose) i.onClose(r.val()); if (!t && i.onSumbit) i.onSumbit(r.val()) } var r = n(this), i = { format: "yyyy-MM-dd", andstr: "至", date: new Date, onClose: null, onSumbit: null }; i = n.extend({}, i, t); var e = n('<div style="position: absolute;z-index: 1;border: 1px double #808080;background-color: #fff;padding:10px;display:none">'), l = n('<a href="javascript:void(0)" class="easyui-linkbutton l-btn l-btn-small" style="float:right;width:60px;margin-right:5px"><span class="l-btn-left"><span class="l-btn-text">确 定<\/span><\/span><\/a>'), a = n('<a href="javascript:void(0)" class="easyui-linkbutton l-btn l-btn-small" style="float:right;width:60px"><span class="l-btn-left"><span class="l-btn-text">清 空<\/span><\/span><\/a>'), s = n('<select style="padding:3px;margin:0px 10px"><option value="0">-快速选择-<\/option><option value="1">近一周内<\/option><option value="2">近一个月<\/option><option value="3">近三个月<\/option><option value="4">近半年内<\/option><option value="5">近一年内<\/option><\/select>'), h = n('<input id="es_textdate" type="text" class="textbox-text validatebox-text textbox-prompt" autocomplete="off" placeholder="" disabled="disabled" style="padding:3px 5px;width:100%">'), y = n('<span class="textbox combo datebox" style="width: 190px; height: 20px;">').append('<span class="textbox-addon textbox-addon-right textbox-icon combo-arrow" style="right: 0px;"><\/span>').append(h), u = n('<div style="width:220px;height:220px;float:left;margin:3px 7px"><\/div>'), f = n('<div style="width:220px;height:220px;float:right;margin:3px 7px"><\/div>'), v = n('<div style="padding:10px 0px">'); v.append(u).append(f); n("body").append(e.append(y).append(s).append(a).append(l).append(v)); l.click(function () { r.val(h.data("date")); c(!1); r.trigger('change'); }); a.click(function () { r.val(""); o(new Date, new Date); c(!1); r.trigger('change'); }); s.change(function () { var t = new Date; switch (n(this).val()) { case "1": t.addWeeks(1); break; case "2": t.addMonths(1); break; case "3": t.addMonths(3); break; case "4": t.addMonths(6); break; case "5": t.addYears(1) } n(this).val("0"); o(new Date, t) }); u.data("es_date", i.date); f.data("es_date", i.date); u.calendar({ formatter: function (n) { var e = u.data("es_date"), t = f.data("es_date"), r = n.getDate(); return n.format(i.format) === t.format(i.format) && e != t ? '<div style="background:#A0E9FF;margin:0px -1px">' + r + "<\/div>" : n < t && n > e ? '<div style="background:#A0E9FF;margin:0px -1px">' + r + "<\/div>" : r }, validator: function (n) { var t = f.data("es_date"), r = n.format(i.format) === t.format(i.format); return r ? r : n < t }, onSelect: function (n) { var t = f.calendar("options").current; o(n, t) } }); f.calendar({ formatter: function (n) { var r = u.data("es_date"), e = f.data("es_date"), t = n.getDate(); return n.format(i.format) === e.format(i.format) ? t : n > r && n < e || n.format(i.format) === r.format(i.format) ? '<div style="background:#A0E9FF;margin:0px -1px">' + t + "<\/div>" : t }, validator: function (n) { var t = u.data("es_date"), r = n.format(i.format) === t.format(i.format); return r ? r : n > t }, onSelect: function (n) { var t = u.calendar("options").current; o(t, n) } }); o(i.date, i.date); r.attr("readonly", "readonly").bind("click", function () { if (e.is(":hidden")) { n(document).data("is_calendar", !0); var t = r.val().split(" " + i.andstr + " "); t.length == 2 && o(parseISO8601(t[0]), parseISO8601(t[1])); p(); r.mouseout(function () { n(document).data("is_calendar", !1) }).mouseover(function () { n(document).data("is_calendar", !0) }); e.mouseout(function () { n(document).data("is_calendar", !1) }).mouseover(function () { n(document).data("is_calendar", !0) }); s.change(function () { n(document).data("is_calendar", !0) }); n(document).click(function () { n(document).data("is_calendar") || c(!0) }) } }) } }) })(jQuery); Date.prototype.addDays = function (n) { this.setDate(this.getDate() + n) }; Date.prototype.addWeeks = function (n) { this.addDays(n * 7) }; Date.prototype.addMonths = function (n) { var t = this.getDate(); this.setMonth(this.getMonth() + n); this.getDate() < t && this.setDate(0) }; Date.prototype.addYears = function (n) { var t = this.getMonth(); this.setFullYear(this.getFullYear() + n); t < this.getMonth() && this.setDate(0) }; Date.prototype.format = function (n) { var i = { "M+": this.getMonth() + 1, "d+": this.getDate(), "h+": this.getHours(), "m+": this.getMinutes(), "s+": this.getSeconds(), "q+": Math.floor((this.getMonth() + 3) / 3), S: this.getMilliseconds() }, t; /(y+)/.test(n) && (n = n.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length))); for (t in i) new RegExp("(" + t + ")").test(n) && (n = n.replace(RegExp.$1, RegExp.$1.length == 1 ? i[t] : ("00" + i[t]).substr(("" + i[t]).length))); return n }